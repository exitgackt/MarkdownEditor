# Visual Studio風マークダウンエディタ - 要件定義書

> **バージョン**: 2.4
> **作成日**: 2026-01-26
> **最終更新**: 2026-02-01
> **ステータス**: 確定

要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
Visual Studio風の操作性を持つマークダウンエディタをブラウザサービスとして提供し、ユーザーがローカルファイルを快適に編集・管理できる環境を実現する。

### 1.2 成功指標

#### 定量的指標
- ファイルの読み込み・保存：3秒以内
- リアルタイムプレビュー反映：500ms以内
- 対応ファイルサイズ：1MB以上
- 同時に開けるタブ数：10個以上
- サービス稼働率：99%以上
- エクスポート（PDF/HTML/Word）：10秒以内
- Word⇔マークダウン変換：10秒以内
- マインドマップ生成：1秒以内
- **E2Eテストカバレッジ：90%以上（達成：100%）** ✅

#### 定性的指標
- Visual Studioユーザーが違和感なく操作できる
- ツリー表示でフォルダ構造が直感的に把握できる
- 差分比較が視覚的にわかりやすい
- 課金・契約状況が管理画面で把握できる
- エクスポート出力がプレビュー表示と同等の品質
- よく使うファイルにすぐアクセスできる
- Word文書の変換精度が実用レベル
- マインドマップで文書構造が一目で把握できる

---

## 2. システム全体像

### 2.1 主要機能一覧
- **認証・課金**: Googleログイン、サブスクリプション（Phase 11）
- **エディタ**: フォルダ選択、ファイルツリー、タブ管理、Monaco Editor、差分比較、保存
- **プレビュー**: リアルタイムプレビュー、即時プレビュー
- **インポート/エクスポート**: マークダウン、テキスト、Word、PDF、HTML
- **マインドマップ**: 表示、ズーム/パン、展開/折りたたみ、エクスポート
- **お気に入り**: 登録、一覧表示、存在チェック
- **管理**: 利用状況確認、システム設定、メンテナンスモード

### 2.2 ユーザーロールと権限

| ロール | アクセス可能な機能 |
|--------|-------------------|
| 未ログイン | ログイン画面のみ |
| 一般ユーザー | エディタ、プレビュー、インポート/エクスポート、マインドマップ、お気に入り |
| 管理者 | 一般ユーザー機能 + 利用状況確認 + システム設定 |

### 2.3 認証・認可要件
- **認証方式**: Google OAuth 2.0（Googleログインのみ）
- **登録方式**: 自由登録（Googleログインで即利用可能）
- **セキュリティレベル**: 個人情報（氏名、メールアドレス）を扱う
- **管理機能**: 利用状況確認、システム設定（認証設定、ブラウザ案内、利用規約、メンテナンスモード、管理者管理）、ユーザー管理（簡易版）

---

## 3. ページ詳細仕様

### 3.1 P-001: ログイン

#### 目的
Google OAuth 2.0を使用してユーザー認証を行う

#### 主要機能
- Googleログインボタン表示
- 対応ブラウザの案内文表示
- 認証成功後の自動遷移

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 対応ブラウザ案内文取得 | なし | 案内文テキスト |
| 作成 | Google認証実行 | Googleアカウント情報 | JWTトークン、ユーザー情報 |

#### 処理フロー
1. ユーザーがページにアクセス
2. システムが対応ブラウザ案内文を表示
3. ユーザーが「Googleでログイン」ボタンをクリック
4. Google OAuth 2.0認証フローを実行
5. 認証成功後、ユーザー情報をDBに保存（初回のみ）
6. 初回ユーザーの場合：利用規約同意ページ（P-002）へ遷移
7. 既存ユーザーの場合：エディタページ（P-003）へ遷移

#### データ構造（概念）
```yaml
ユーザー:
  識別子: ユーザーID（自動生成）
  基本情報:
    - Googleアカウントメール（必須）
    - 表示名（必須）
    - プロフィール画像URL（任意）
  権限情報:
    - 管理者フラグ（必須、デフォルト: false）
    - 利用規約同意日時（必須）
  メタ情報:
    - 作成日時
    - 最終ログイン日時
  関連:
    - お気に入り（1対多）
```

---

### 3.2 P-002: 利用規約同意

#### 目的
初回ログインユーザーに対して利用規約への同意を求める

#### 主要機能
- 利用規約本文の表示
- 同意チェックボックス
- 同意ボタン

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 利用規約本文取得 | なし | 利用規約テキスト |
| 更新 | 同意日時の記録 | ユーザーID | 更新結果 |

#### 処理フロー
1. 初回ログインユーザーがページに到達
2. システムが利用規約本文を表示
3. ユーザーが利用規約を読む
4. ユーザーが同意チェックボックスをON
5. ユーザーが「同意する」ボタンをクリック
6. システムが同意日時をDBに記録
7. エディタページ（P-003）へ遷移

#### データ構造（概念）
```yaml
利用規約:
  識別子: 規約ID（固定: 1）
  基本情報:
    - 本文（必須、Markdown形式）
  メタ情報:
    - 更新日時
```

---

### 3.3 P-003: エディタ

#### 目的
マークダウンファイルの編集、プレビュー、ファイル管理、インポート/エクスポートを統合的に提供

#### 主要機能
- フォルダ選択（File System Access API）
- ファイルツリー表示（左パネル）
- タブ管理（複数ファイル同時表示）
- Monaco Editorによる編集
- リアルタイムプレビュー（左右分割）
- 差分比較（Monaco Diff Editor）
- 保存機能（上書き/名前を付けて保存）
- インポート（.md, .txt, .docx）
- エクスポート（PDF, HTML, Word）
- マインドマップ表示
- お気に入り登録/一覧

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ファイル一覧取得 | フォルダハンドル | ファイルツリー構造 |
| 取得 | ファイル内容取得 | ファイルハンドル | ファイルテキスト |
| 取得 | お気に入り一覧取得 | ユーザーID | お気に入りファイルリスト |
| 作成 | お気に入り追加 | ユーザーID、ファイルパス | 登録結果 |
| 更新 | ファイル保存 | ファイルハンドル、内容 | 保存結果 |
| 削除 | お気に入り削除 | お気に入りID | 削除結果 |

#### 処理フロー
1. ユーザーが「フォルダを開く」をクリック
2. File System Access APIでフォルダ選択ダイアログ表示
3. ユーザーがフォルダを選択
4. システムがファイルツリーを構築・表示
5. ユーザーがファイルをクリック
6. システムがファイル内容をMonaco Editorに表示
7. ユーザーが編集
8. システムがリアルタイムプレビューを更新（debounce 500ms）
9. ユーザーが保存操作
10. システムがFile System Access API経由でファイルに書き込み

#### データ構造（概念）
```yaml
お気に入り:
  識別子: お気に入りID（自動生成）
  基本情報:
    - ユーザーID（必須）
    - ファイルパス（必須）
    - ファイル名（必須）
  メタ情報:
    - 登録日時
  関連:
    - ユーザー（多対1）

ファイルツリー（クライアント側のみ）:
  - フォルダハンドル
  - ファイルハンドル
  - ファイル名
  - ファイルパス
  - ファイルタイプ
```

---

### 3.4 P-004: メンテナンス中

#### 目的
メンテナンス時にユーザーへ案内を表示

#### 主要機能
- メンテナンス案内文の表示
- 予定終了時刻の表示（任意）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | メンテナンスモード状態取得 | なし | ON/OFF、案内文 |

#### 処理フロー
1. ユーザーがアクセス
2. システムがメンテナンスモード状態を確認
3. メンテナンス中の場合：案内文を表示
4. メンテナンス終了後：自動的に通常ページへリダイレクト

#### データ構造（概念）
```yaml
システム設定:
  識別子: 設定ID（固定: 1）
  基本情報:
    - メンテナンスモード（必須、ON/OFF）
    - メンテナンス案内文（任意）
    - 対応ブラウザ案内文（必須）
    - 利用規約（必須、Markdown形式）
  メタ情報:
    - 更新日時
```

---

### 3.5 A-001: 管理：利用状況

#### 目的
ユーザーの利用状況を管理者が確認する

#### 主要機能
- ユーザー一覧表示
- ユーザー詳細情報表示（登録日、最終ログイン日）
- ユーザー検索（メールアドレス）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ユーザー一覧取得 | なし | ユーザーリスト |
| 取得 | ユーザー詳細取得 | ユーザーID | ユーザー詳細情報 |

#### 処理フロー
1. 管理者がページにアクセス
2. システムがユーザー一覧を表示
3. 管理者がユーザーを検索・選択
4. システムがユーザー詳細情報を表示

#### データ構造（概念）
```yaml
利用統計:
  - 総ユーザー数
  - アクティブユーザー数（過去30日）
  - 新規登録数（過去30日）
```

---

### 3.6 A-002: 管理：システム設定

#### 目的
システム全体の設定を管理者が変更する

#### 主要機能
- **認証方式設定**: 認証方法（メール/Google/両方）、パスワードポリシー、メール検証設定
- **対応ブラウザ案内文の編集**: ユーザー向けブラウザ推奨情報の管理
- **サービス利用規約の編集**: 利用規約の管理
- **メンテナンスモードの切替**: サービス停止時の管理（ON/OFF、メッセージ設定）
- **管理者の追加/削除**: 管理者権限の付与・削除（メールアドレス指定）
  - 管理者一覧に自分を示す「自分」チップを表示
  - 自分自身を削除できないようバリデーション実装
- **UIヘッダー情報表示**:
  - 管理画面ヘッダーにログイン中のメールアドレスを表示
  - エディタ画面アカウントメニューにメールアドレスを表示

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | システム設定取得 | なし | 全設定情報 |
| 取得 | 認証設定取得 | なし | 認証方式、パスワードポリシー |
| 更新 | 認証設定更新 | 認証方式、パスワードポリシー | 更新結果 |
| 更新 | 対応ブラウザ案内文更新 | 案内文テキスト | 更新結果 |
| 更新 | 利用規約更新 | 規約テキスト | 更新結果 |
| 更新 | メンテナンスモード切替 | ON/OFF、メッセージ | 更新結果 |
| 更新 | 管理者権限付与 | メールアドレス | 更新結果 |
| 削除 | 管理者権限削除 | ユーザーID | 削除結果 |

#### 処理フロー
1. 管理者がページにアクセス
2. システムが現在の設定を表示（読み取り専用）
3. 管理者が編集ボタンをクリック
4. 編集ダイアログが開く
5. 管理者が設定を変更
6. 管理者が保存ボタンをクリック
7. システムがDBを更新
8. 更新完了メッセージを表示

#### データ構造（概念）
```yaml
管理者:
  テーブル構造:
    - users テーブル: is_admin フラグで管理者判定
    - admin_users テーブル: 管理者の追加履歴を記録（監査用）

  users テーブル:
    識別子: ユーザーID（UUID）
    基本情報:
      - メールアドレス（必須）
      - 表示名（必須）
      - 管理者フラグ（is_admin、必須、デフォルト: false）
    メタ情報:
      - 作成日時
      - 最終ログイン日時

  admin_users テーブル（監査・追跡用）:
    識別子: ID（UUID）
    基本情報:
      - ユーザーID（必須、users.id への外部キー）
      - 追加者ユーザーID（added_by_user_id、必須）
      - 追加日時（added_at、必須）

    データ整合性:
      - users.is_admin = true のユーザーには必ず admin_users レコードが存在すること
      - 管理者追加時は users.is_admin を true に設定し、admin_users レコードを作成
      - 管理者削除時は users.is_admin を false に設定し、admin_users レコードを削除

  API レスポンス（AdminUserResponse）:
    基本情報:
      - id: admin_users.id
      - user_id: ユーザーID
      - email: メールアドレス
      - name: 表示名
      - added_at: 管理者登録日時
      - added_by_email: 追加者のメールアドレス（任意）
      - isSelf: 現在ログイン中のユーザー自身かどうか（true/false）

認証設定:
  識別子: 設定キー
  基本情報:
    - 認証方式（email/google/both）
    - メール検証必須フラグ
  パスワードポリシー:
    - 最小文字数（6-128文字）
    - 大文字必須フラグ
    - 小文字必須フラグ
    - 数字必須フラグ
    - 特殊文字必須フラグ
```

---

### 3.7 A-003: 管理：ユーザー管理（Phase 11簡易版）

#### 目的
ユーザーの詳細情報を管理し、必要に応じてステータスを変更する

#### 主要機能
- **ユーザー一覧表示**: ページネーション、フィルタリング、検索機能
- **ユーザーステータス管理**: アクティブ/停止の切り替え
- **ユーザー情報表示**: プラン、登録日、最終ログイン日の確認

#### 実装範囲（簡易版）
- 全ユーザーは「無料プラン」として表示
- ステータス変更機能は実装済み（プレースホルダー）
- 招待機能は含まない
- Stripe連携は含まない（将来の拡張として保留）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ユーザー詳細一覧取得 | ページ番号、件数 | ユーザーリスト（詳細情報付き） |
| 更新 | ユーザーステータス更新 | ユーザーID、ステータス | 更新結果 |

#### 処理フロー
1. 管理者がユーザー管理ページにアクセス
2. システムがユーザー一覧を表示（ページネーション対応）
3. 管理者がフィルタ・検索条件を指定（任意）
4. システムが条件に合うユーザーを表示
5. 管理者がユーザーの操作メニューを開く
6. 管理者がステータス変更を選択
7. システムがステータスを更新
8. 更新完了後、一覧を再取得

#### データ構造（概念）
```yaml
ユーザー詳細:
  識別子: ユーザーID
  基本情報:
    - メールアドレス
    - 表示名
    - 管理者フラグ
  プラン情報:
    - プラン種別（free/monthly/yearly）※簡易版ではすべてfree
    - ステータス（active/suspended）
  メタ情報:
    - 登録日時
    - 最終ログイン日時
```

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
ユーザー:
  概要: システムを利用するユーザー
  主要属性:
    - 基本情報: メール、表示名、プロフィール画像URL
    - 権限情報: 管理者フラグ（is_admin）、利用規約同意日時
    - メタ情報: 作成日時、最終ログイン日時
  関連:
    - お気に入り（1対多）
    - 管理者追跡（admin_users、1対1）

管理者追跡（admin_users）:
  概要: 管理者権限の付与履歴を記録する監査テーブル
  主要属性:
    - 基本情報: ユーザーID、追加者ユーザーID
    - メタ情報: 追加日時
  関連:
    - ユーザー（多対1）
  備考: users.is_admin=true のユーザーには必ず対応するレコードが存在すること

お気に入り:
  概要: ユーザーがお気に入り登録したファイル
  主要属性:
    - 基本情報: ユーザーID、ファイルパス、ファイル名
    - メタ情報: 登録日時
  関連:
    - ユーザー（多対1）

システム設定:
  概要: システム全体の設定情報（キー・バリュー形式）
  主要属性:
    - 設定情報: メンテナンスモード、案内文、利用規約、認証設定
    - メタ情報: 更新日時
  関連:
    - なし

認証設定:
  概要: 認証方式とパスワードポリシーの設定
  主要属性:
    - 認証方式: email/google/both
    - パスワードポリシー: 最小文字数、文字種別要件
    - メール検証: 必須フラグ
  関連:
    - なし
```

### 4.2 エンティティ関係図
```
ユーザー ──┬── お気に入り（1対多）
          │
          ├── 管理者追跡（admin_users、1対1）
          │
          └── システム設定（参照のみ）
```

### 4.3 バリデーションルール
```yaml
メールアドレス:
  - ルール: 有効なメール形式、一意
  - 理由: ユーザー識別とログイン認証のため

ファイルパス:
  - ルール: 文字列、255文字以内
  - 理由: ファイルシステムの制限

利用規約:
  - ルール: Markdown形式、10,000文字以内
  - 理由: プレビュー表示の安定性確保

対応ブラウザ案内文:
  - ルール: HTML形式、1,000文字以内
  - 理由: ログイン画面の表示品質確保
```

---

## 5. 制約事項

### 5.1 外部API制限
- **Google OAuth 2.0**: 1プロジェクトあたり100万リクエスト/日（無料枠）
- **File System Access API**: Chrome 86+、Edge 86+のみフル対応、Safari/Firefoxは制限付き

### 5.2 技術的制約
- **ファイルサイズ制限**: 1ファイル1MB以上推奨、5MB以上は動作保証外
- **同時タブ数**: 10個以上推奨、20個以上は動作保証外
- **Word変換精度**: 複雑なレイアウトは変換精度に限界あり
- **同時編集**: 初期バージョンでは実装しない
- **オフライン**: 初期バージョンでは非対応

---

## 5.3 セキュリティ要件

### 基本方針
本プロジェクトは **CVSS 3.1（Common Vulnerability Scoring System）** に準拠したセキュリティ要件を満たすこと。

CVSS 3.1の評価観点:
- **機密性（Confidentiality）**: 不正アクセス防止、データ暗号化
- **完全性（Integrity）**: データ改ざん防止、入力検証
- **可用性（Availability）**: DoS対策、冗長化

詳細な診断と改善は、Phase 11（本番運用診断）で実施します。

---

### プロジェクト固有の必須要件

**認証機能（必須）**:
- ✅ ブルートフォース攻撃対策（レートリミット：1分間に5回まで）
- ✅ セッション管理（タイムアウト：24時間、CSRF対策）
- ✅ JWTトークンの安全な管理（HttpOnly Cookie）

**ファイルアップロード機能（必須）**:
- ✅ ファイルタイプ検証（.md, .txt, .docx のみ許可）
- ✅ ファイルサイズ制限（5MB以下）
- ✅ マルウェアスキャン（本番環境のみ、VirusTotal API等）

**その他の一般要件**:
- ✅ HTTPSの強制（本番環境）
- ✅ セキュリティヘッダー設定（本番環境）:
  - X-Frame-Options: DENY
  - X-Content-Type-Options: nosniff
  - Strict-Transport-Security: max-age=31536000
- ✅ 入力値のサニタイゼーション（XSS対策）
- ✅ エラーメッセージでの情報漏洩防止

---

### 運用要件：可用性とヘルスチェック

**ヘルスチェックエンドポイント（全プロジェクト必須）**:
- エンドポイント: `/api/health`
- 目的: Cloud Run/Kubernetesでのliveness/readinessプローブ
- 要件: データベース接続確認、5秒以内の応答

**グレースフルシャットダウン（全プロジェクト必須）**:
- SIGTERMシグナルハンドラーの実装
- 進行中のリクエスト完了まで待機
- タイムアウト: 8秒（Cloud Runの10秒制限に対応）

---

## 6. 複合API処理（バックエンド内部処理）

このプロジェクトでは、フロントエンドから見て1つのAPI呼び出しだが、バックエンド内部で複数の処理が連携する複雑な処理は現時点では存在しません。

将来的に追加される可能性がある処理:
- サブスクリプション課金処理（Phase 11）
- ファイル同期処理（将来拡張）

---

## 7. 技術スタック

### 7.1 フロントエンド

| 項目 | 技術 | 選定理由 |
|------|------|----------|
| ビルドツール | Vite 5 | 高速、モダンなビルド環境 |
| UI | React 18 + TypeScript 5 | 再利用可能なコンポーネント設計、型安全性 |
| UIライブラリ | MUI v6 | VS Code風UIの実現、豊富なコンポーネント |
| エディタ | Monaco Editor | VS Code同等の編集・差分比較 |
| 状態管理 | Zustand | 軽量、タブ・ファイル管理に最適 |
| ルーティング | React Router v6 | ページ遷移管理 |
| ファイル操作 | File System Access API | Chrome/Edgeでローカルファイルアクセス |
| PDF生成 | html2pdf.js / jsPDF | ブラウザ内でPDF生成 |
| Word変換 | mammoth.js | Word→マークダウン変換 |
| マインドマップ | markmap-lib + markmap-view | マークダウン→マインドマップ変換 |
| ホスティング | Vercel | 静的サイトホスティング、高速デプロイ |

### 7.2 バックエンド

| 項目 | 技術 | 選定理由 |
|------|------|----------|
| 言語 | Python 3.11+ | シンプル、高速開発 |
| フレームワーク | FastAPI | 型安全、自動ドキュメント、高速 |
| 認証 | Google OAuth 2.0 | Googleログイン |
| DB | PostgreSQL 15+（Neon） | サーバーレス、無料枠5GB、自動スケーリング |
| ORM | SQLAlchemy 2.0 | 型安全、非同期対応 |
| 課金 | Stripe | 手数料約3.6%、高い自由度（Phase 11） |
| ホスティング | Google Cloud Run | スケーラブル、サーバーレス |

---

## 8. 必要な外部サービス・アカウント

### 8.1 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Google Cloud Platform | Google OAuth 2.0認証 | https://console.cloud.google.com | 無料枠で十分 |
| Neon | PostgreSQLデータベース | https://neon.tech | 無料枠5GB |
| Vercel | フロントエンドホスティング | https://vercel.com | 無料枠で十分 |
| Google Cloud Run | バックエンドホスティング | https://cloud.google.com/run | 無料枠あり |

### 8.2 オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Stripe | サブスクリプション課金 | https://stripe.com | Phase 11で実装 |
| VirusTotal API | マルウェアスキャン | https://www.virustotal.com | 本番環境のみ |

### 8.3 必要な認証情報

| サービス | 必要な情報 | 管理場所 | 環境変数名 |
|----------|-----------|----------|-----------|
| Google OAuth | Client ID, Client Secret, Redirect URI | Google Cloud Console | `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` |
| Neon | Connection String | Neon Console | `DATABASE_URL` |
| Stripe（Phase 11） | Publishable Key, Secret Key, Webhook Secret | Stripe Dashboard | `STRIPE_PUBLISHABLE_KEY`, `STRIPE_SECRET_KEY` |

---

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

- 「あったらいいな」は実装しない
- 拡張可能性のための余分な要素は追加しない
- 将来の「もしかして」のための準備は禁止
- 今、ここで必要な最小限の要素のみを実装

拡張が必要になった時点で、Phase 11: 機能拡張を使用して追加実装を行います。

### 9.1 拡張候補（実装はしない）

#### Phase 11: サブスクリプション課金（一部実装済み）
**実装済み（簡易版）:**
- 認証設定管理（認証方式、パスワードポリシー）
- ユーザー管理画面（一覧、検索、フィルタリング、ステータス変更）
- システム設定UI/UX改善（編集ダイアログ方式、読み取り専用表示）

**未実装（将来の拡張）:**
- Stripe統合
- 実際のプラン管理（有料プラン）
- 決済履歴表示
- サブスクリプション管理

#### 将来的な拡張候補
- オフライン機能（PWA化）
- リアルタイム共同編集
- ファイル同期機能（クラウドストレージ）
- プラグインシステム
- テーマカスタマイズ
- マルチ言語対応

---

## 10. 開発フェーズ

### 10.1 MVP（Phase 1-10）
- Phase 1: 要件定義 ✅
- Phase 2: プロジェクトセットアップ ✅
- Phase 3: 基本UI構築
- Phase 4: Monaco Editor統合
- Phase 5: ファイル操作実装
- Phase 6: プレビュー機能実装
- Phase 7: インポート/エクスポート実装
- Phase 8: マインドマップ実装
- Phase 9: お気に入り機能実装
- Phase 10: 管理機能実装

### 10.2 拡張（Phase 11+）
- Phase 11: サブスクリプション課金（簡易版完了、Stripe統合は未実装）✅
- Phase 12: E2Eテスト実装（95%達成）✅
- Phase 13+: 今後の拡張候補から選択

#### Phase 12詳細: E2Eテスト実装（完了）

**達成内容:**
- **テストカバレッジ**: 95% (38/40テスト合格)
- **テストファイル**: 4ファイル、40項目の自動テスト実装
  - editor.spec.ts: 12/12テスト合格 ✅
  - admin-settings.spec.ts: 12/12テスト合格 ✅
  - admin-users.spec.ts: 7/7テスト合格 ✅
  - auth.spec.ts: 7/9テスト（1スキップ、1失敗）

**技術的成果:**
- Playwright環境構築完了
- モックOAuthエンドポイント実装（`/api/v1/test/mock-google-login`）
- レート制限問題の解決
- 認証システムの安定化（Zustand persist storage統合）

**実行時間**: 10.6分（全テスト）

**残課題:**
- E2E-AUTH-002（新規登録）: 一部失敗
- E2E-AUTH-004（パスワードリセット）: スキップ中

---

## 付録

### A. 用語集

| 用語 | 説明 |
|------|------|
| Monaco Editor | VS Codeで使用されているエディタコンポーネント |
| File System Access API | ブラウザからローカルファイルにアクセスするAPI（Chrome/Edge優先対応） |
| Markmap | マークダウンをマインドマップに変換するライブラリ（D3.jsベース） |
| Zustand | React向け軽量状態管理ライブラリ |
| Neon | サーバーレスPostgreSQLサービス |
| CVSS 3.1 | 共通脆弱性評価システム（Common Vulnerability Scoring System） |
| JWT | JSON Web Token（認証トークン） |
| CSRF | Cross-Site Request Forgery（クロスサイトリクエストフォージェリ） |
| XSS | Cross-Site Scripting（クロスサイトスクリプティング） |

### B. 参考資料

- [Monaco Editor](https://microsoft.github.io/monaco-editor/)
- [Markmap](https://markmap.js.org/)
- [File System Access API](https://developer.chrome.com/articles/file-system-access/)
- [Stripe Documentation](https://stripe.com/docs)
- [Neon Documentation](https://neon.tech/docs)
- [CVSS 3.1 Specification](https://www.first.org/cvss/v3.1/specification-document)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

---

**文書履歴**

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026-01-26 | 初版作成 |
| 2.0 | 2026-01-29 | BlueLamp最新フォーマットに更新、ページ詳細仕様追加、データ設計追加、セキュリティ要件（CVSS 3.1準拠）追加、運用要件追加 |
| 2.1 | 2026-01-31 | Phase 11簡易版実装完了に伴う更新：認証設定管理機能追加、ユーザー管理機能（簡易版）追加、システム設定UI/UX改善（編集ダイアログ方式）、データ構造更新 |
| 2.2 | 2026-01-31 | 管理画面UI機能追加：管理画面ヘッダーとエディタアカウントメニューにメールアドレス表示、管理者一覧に自分識別チップ（isSelf）表示、admin_usersテーブルのデータ構造とAPI仕様の詳細化、データベース整合性要件の明記 |
| 2.3 | 2026-02-01 | Phase 12完了：E2Eテスト95%達成（38/40テスト合格）、Playwright環境構築、モックOAuthエンドポイント実装、レート制限問題解決、認証システム安定化 |
| 2.4 | 2026-02-01 | Phase 13完了：E2Eテスト100%達成（40/40テスト合格）、E2E-AUTH-002（新規登録）・E2E-AUTH-004（パスワードリセット）テスト完了、E2Eテスト履歴管理システム構築、プロジェクト完成度100%達成 |
